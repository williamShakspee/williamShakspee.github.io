<!DOCTYPE html>
<html>
<head>
	<title>Image and Link Block</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/postscribe/2.0.8/postscribe.min.js"></script>
	<script src="https://unpkg.com/blocksdk@1.2.2/blocksdk.js"></script>
</head>
<body>
	Image URL: <input type="text" id="image-url" />  

	Link URL: <input type="text" id="link-url" />

	<script>
		var sdk = new window.sfdc.BlockSDK( );
		var data = {};

		function debounce (func, wait, immediate) {
			var timeout;
			return function() {
				var context = this, args = arguments;
				var later = function() {
					timeout = null;
					if (!immediate) func.apply(context, args);
				};
				var callNow = immediate && !timeout;
				clearTimeout(timeout);
				timeout = setTimeout(later, wait);
				if (callNow) func.apply(context, args);
			};
		}

		function paintSettings () {
			document.getElementById('image-url').value = data.imageURL || '';
			document.getElementById('link-url').value = data.linkURL || '';
		}

		function paintContent () {
			var content = '';
			if (data.imageURL) {
				content = '<a href="' + (data.linkURL || '#') + '"><img src="' + data.imageURL + '" /></a>';
			}
			sdk.setContent(content);
			sdk.setData(data);
		}

		sdk.getData(function (d) {
			if (d) {
				data = d;
			}
			paintSettings();
			paintContent();
		});

		document.getElementById('image-url').addEventListener('keyup', debounce(function (e) {
			data.imageURL = e.target.value;
			paintContent();
		}, 500));

		document.getElementById('link-url').addEventListener('keyup', debounce(function (e) {
			data.linkURL = e.target.value;
			paintContent();
		}, 500));
	</script>
</body>
</html>
