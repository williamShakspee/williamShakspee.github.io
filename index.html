<!DOCTYPE html>
<html lang="en">
<head>
    <title>Responsive YouTube Iframe Block</title>
    <meta charset="utf-8">
    <style>
        /* Styling for the block's user interface in the editor */
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; color: #333; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"] { width: 95%; padding: 8px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        #status { font-style: italic; color: #555; }
    </style>
    <!-- Using the reliable, raw GitHub link for the SDK -->
    <script src="https://raw.githack.com/salesforce-marketingcloud/blocksdk/master/blocksdk.js"></script>
</head>
<body>
    <label for="youtube-url">YouTube Video URL:</label>
    <input type="text" id="youtube-url" placeholder="e.g., https://www.youtube.com/watch?v=...">
    <div id="status">Enter a URL to generate the embed code.</div>

    <script>
        document.addEventListener('DOMContentLoaded', function ( ) {
            
            var sdk = new window.sfdc.BlockSDK();
            var youtubeUrlInput = document.getElementById('youtube-url');
            var statusDiv = document.getElementById('status');
            var debounceTimeout;

            function getYouTubeId(url) {
                if (!url) return null;
                var ID = '';
                url = url.replace(/(>|<)/gi, '').split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/);
                if (url[2] !== undefined) {
                    ID = url[2].split(/[^0-9a-z_\-]/i);
                    ID = ID[0];
                } else {
                    ID = url;
                }
                return ID;
            }

            // *** THIS IS THE MODIFIED PART ***
            // This function now generates the responsive iframe HTML for a web page.
            function generateWebHtml(videoId) {
                if (!videoId) {
                    return '<div style="padding:20px; text-align:center; font-family: Arial, sans-serif;">Please provide a valid YouTube URL.</div>';
                }
                
                // The embed URL for YouTube. We can add parameters here if needed.
                const embedUrl = `https://www.youtube.com/embed/${videoId}?rel=0&autoplay=0&mute=0`;

                // The CSS required for the responsive container.
                // This will be placed in the <head> of the CloudPage by SFMC.
                const responsiveCss = `
                    <style>
                        .iframe-outer-wrapper {
                            max-width: 800px; /* You can set a max-width for the video */
                            margin: 0 auto; /* Center the container */
                        }
                        .iframe-container {
                            position: relative;
                            overflow: hidden;
                            width: 100%;
                            padding-top: 56.25%; /* 16:9 Aspect Ratio */
                        }
                        .iframe-container iframe {
                            position: absolute;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            border: 0;
                        }
                    </style>
                `;

                // The final HTML structure including the CSS.
                return `
                    ${responsiveCss}
                    <div class="iframe-outer-wrapper">
                        <div class="iframe-container">
                            <iframe src="${embedUrl}"
                                    frameborder="0"
                                    allow="autoplay; accelerometer; encrypted-media; gyroscope; fullscreen; picture-in-picture"
                                    allowfullscreen>
                            </iframe>
                        </div>
                    </div>
                `;
            }

            function updateBlock( ) {
                var url = youtubeUrlInput.value;
                var videoId = getYouTubeId(url);
                
                if (videoId) {
                    statusDiv.textContent = 'Embed code updated.';
                } else if (url) {
                    statusDiv.textContent = 'Invalid YouTube URL.';
                } else {
                    statusDiv.textContent = 'Enter a URL to generate the embed code.';
                }

                var webHtml = generateWebHtml(videoId);

                sdk.setContent(webHtml);
                sdk.setData({ youtubeUrl: url });
            }

            function debounceUpdate() {
                clearTimeout(debounceTimeout);
                debounceTimeout = setTimeout(updateBlock, 500);
            }

            sdk.getData(function (data) {
                if (data && data.youtubeUrl) {
                    youtubeUrlInput.value = data.youtubeUrl;
                }
                updateBlock();
            });

            youtubeUrlInput.addEventListener('input', debounceUpdate);
        });
    </script>
</body>
</html>
